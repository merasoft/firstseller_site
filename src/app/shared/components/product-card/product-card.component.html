<!-- Product Card -->
<article class="h-full flex flex-col bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-lg sm:hover:-translate-y-0.5 transition-all duration-300 overflow-hidden relative group">
  <!-- Product Link Container -->
  <a [routerLink]="['/catalog/product', product.id]" class="flex-1 flex flex-col">
    <!-- Badge -->
    <div *ngIf="product.badge" class="absolute top-1 left-2 sm:top-4 sm:left-4 z-10">
      <span class="inline-block text-[10px] sm:text-xs font-medium sm:font-bold px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-white shadow-sm" [ngClass]="getBadgeClasses(product.badgeType)">
        {{ getTranslatedBadge(product.badge, product.badgeType) }}
      </span>
    </div>

    <!-- Product Image -->
    <div class="image-container relative aspect-square overflow-hidden group/image" (click)="$event.stopPropagation()">
      <p-carousel
        #imageCarousel
        [value]="product.images"
        [numVisible]="1"
        [numScroll]="1"
        [circular]="true"
        [autoplayInterval]="0"
        [showIndicators]="product.images.length > 1"
        [showNavigators]="product.images.length > 1"
        [page]="product.currentImageIndex"
        (onPage)="onCarouselPageChange($event)"
        class="product-image-carousel">
        <ng-template pTemplate="item" let-image>
          <img [src]="image" [alt]="product.name" class="w-full h-full object-cover" loading="lazy" />
        </ng-template>
      </p-carousel>

      <!-- Favorite & Compare -->
      <div class="hidden md:flex flex-col gap-2 absolute top-3 right-3 translate-x-14 group-hover/image:translate-x-0 transition-all duration-300">
        <button (click)="$event.preventDefault(); onAddToFavorites(product)" class="group/fav action-button" [class.active]="isInWishlist()" [title]="'PRODUCTS.ADD_TO_FAVORITES_TITLE' | translate">
          <i class="text-base transition-colors" [class]="isInWishlist() ? 'text-red-500 pi pi-heart-fill' : 'text-gray-700 group-hover/fav:text-red-500 pi pi-heart'"></i>
        </button>

        <button (click)="$event.preventDefault(); onAddToCompare(product)" class="group/comp action-button" [class.active]="isInCompare()" [title]="'PRODUCTS.ADD_TO_COMPARE_TITLE' | translate">
          <i class="text-base transition-colors" [class]="isInCompare() ? 'text-blue-500 fa-solid fa-scale-balanced' : 'text-gray-700 group-hover/comp:text-blue-500 fa-solid fa-scale-balanced'"></i>
        </button>
      </div>
    </div>

    <!-- Product Info -->
    <div class="p-3 sm:p-4 space-y-2 flex-1 flex flex-col">
      <!-- Product Name -->
      <h3 class="text-sm font-medium text-gray-900 line-clamp-2 leading-tight group-hover:text-primary-700 transition-colors">
        {{ product.name }}
      </h3>

      <!-- Rating -->
      <div class="flex items-center gap-2">
        <div class="flex items-center">
          <div *ngFor="let star of getStars(product.rating)" class="w-4 h-4">
            <ng-container [ngSwitch]="star">
              <svg *ngSwitchCase="'full'" class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                <path
                  d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.176 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
              </svg>
              <svg *ngSwitchCase="'half'" class="w-4 h-4 text-yellow-400" viewBox="0 0 20 20">
                <defs>
                  <linearGradient id="half-grad" x1="0" x2="1" y1="0" y2="0">
                    <stop offset="50%" stop-color="currentColor" />
                    <stop offset="50%" stop-color="#D1D5DB" />
                  </linearGradient>
                </defs>
                <path
                  fill="url(#half-grad)"
                  d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.176 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
              <svg *ngSwitchCase="'empty'" class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                <path
                  d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.176 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
              </svg>
            </ng-container>
          </div>
        </div>
        <span class="text-xs text-gray-500">
          ( {{ product.reviewsCount }} <span class="hidden sm:inline">{{ getReviewText(product.reviewsCount) }} </span>)
        </span>
      </div>

      <!-- Price -->
      <div class="space-y-1 !mt-auto pt-2">
        <div *ngIf="product.oldPrice" class="text-xs sm:text-sm text-gray-500 line-through"> {{ formatPrice(product.oldPrice!) }} {{ getCurrency() }} </div>
        <div class="text-base sm:text-lg font-bold text-gray-900"> {{ formatPrice(product.price) }} {{ getCurrency() }} </div>
      </div>

      <!-- Monthly Payment -->
      <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-md p-1 text-center">
        <div class="text-orange-700 font-normal sm:font-semibold text-[11px] sm:text-sm">
          {{ formatPrice(product.monthlyPayment) }} {{ getCurrency() }} Ã— {{ product.installmentMonths }} {{ 'PRODUCTS.MONTHLY_PAYMENT' | translate }}
        </div>
      </div>
    </div>
  </a>

  <!-- Action Buttons (Outside of link) -->
  <div class="px-3 pb-3 sm:px-4 sm:pb-4 space-y-2">
    <!-- Primary Actions -->
    <div class="flex items-center gap-2">
      <button
        (click)="onBuyOneClick(product)"
        class="flex-1 h-8 sm:h-9 bg-primary-600 hover:bg-primary-700 text-white rounded-md sm:rounded-lg font-medium text-sm transition-all duration-200 hover:transform hover:scale-[1.02]">
        {{ 'PRODUCTS.BUY_NOW' | translate }}
      </button>

      <button
        (click)="onAddToCart(product)"
        class="w-10 h-8 sm:h-9 bg-green-500 hover:bg-green-600 text-white rounded-md sm:rounded-lg font-medium text-sm transition-all duration-200 hover:transform hover:scale-[1.02] flex items-center justify-center gap-1"
        [title]="'PRODUCTS.ADD_TO_CART_SHORT' | translate">
        <i class="pi pi-shopping-cart"></i>
      </button>
    </div>
  </div>
</article>
